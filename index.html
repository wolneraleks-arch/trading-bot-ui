<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
</head>
<body>
    <script>
        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –í–ö
        vkBridge.send("VKWebAppInit", {});

        // 2. –°—Å—ã–ª–∫–∞ –Ω–∞ –≤–∞—à–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Google Apps Script
        const GAS_URL = "https://script.google.com/macros/s/AKfycbx1RtFb9o-XMooNAFgD-tnnDeprncLYvSzfxveWmsFa9H2-ZXUo4Gp6G10i9BvpHd6cgA/exec";

        // 3. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (vk_user_id –∏ —Ç.–¥.)
        const currentParams = window.location.search;
        window.location.href = GAS_URL + currentParams;
    </script>
</body>
</html> -->

<!-- –≤–µ—Ä—Å–∏—è 2 –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; color: #444; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        button { background: #0077ff; color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="card">
    <h3 id="title">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
    <p id="status">–ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø</p>
    <div id="content" style="display:none">
        <p>–í–∞—à–∏ —Ç–∏–∫–µ—Ä—ã: <b id="tickers"></b></p>
        <button onclick="buySubscription()">–ü—Ä–æ–¥–ª–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
    </div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbx1RtFb9o-XMooNAFgD-tnnDeprncLYvSzfxveWmsFa9H2-ZXUo4Gp6G10i9BvpHd6cgA/exec"; 

    async function start() {
        const title = document.getElementById('title');
        const statusText = document.getElementById('status');

        try {
            await vkBridge.send("VKWebAppInit");
            const urlParams = new URLSearchParams(window.location.search);
            const vkId = urlParams.get('vk_user_id');

            if (!vkId) {
                title.innerText = "–û—à–∏–±–∫–∞";
                statusText.innerText = "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –í–ö";
                return;
            }

            // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å –∏–∑ –¢—Ä–∏–±—É—Ç–∞ (–ø–æ–∑–∂–µ –∑–∞–º–µ–Ω–∏–º –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É)
            const tributeStatus = "active"; 

            // –ó–∞–ø—Ä–æ—Å –∫ GAS
            const requestUrl = `${GAS_URL}?action=check_or_register&vk_id=${vkId}&tribute_status=${tributeStatus}`;
            
            const response = await fetch(requestUrl);
            if (!response.ok) throw new Error("–°–µ—Ç—å –Ω–µ –æ—Ç–≤–µ—Ç–∏–ª–∞");
            
            const result = await response.json();

            if (result.status === "guest") {
                title.innerText = "–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω";
                statusText.innerText = "–û–ø–ª–∞—Ç–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É, —á—Ç–æ–±—ã –±–æ—Ç –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å.";
            } else {
                title.innerText = "–ù–∞—Å—Ç—Ä–æ–π–∫–∏";
                statusText.innerText = "–ü–æ–¥–ø–∏—Å–∫–∞: " + (result.data.active === "–î–∞" ? "–ê–∫—Ç–∏–≤–Ω–∞ ‚úÖ" : "–ò—Å—Ç–µ–∫–ª–∞ ‚ùå");
                document.getElementById('tickers').innerText = result.data.tickers;
                document.getElementById('content').style.display = "block";
            }

        } catch (err) {
            title.innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏";
            statusText.innerText = "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è —Å —Ç–∞–±–ª–∏—Ü–µ–π. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–µ–ø–ª–æ–π GAS.";
            console.error(err);
        }
    }

    start();
</script>

</body>
</html> -->



<!-- –í–µ—Ä—Å–∏—è 3 —Å –¥–∏–∑–∞–π–Ω–æ–º -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no">
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <style>
        :root { --vk-blue: #0077ff; --bg-gray: #f0f2f5; }
        body { font-family: -apple-system, system-ui, "Helvetica Neue", Roboto, sans-serif; background: var(--bg-gray); margin: 0; padding: 0; color: #000; }
        
        /* –°–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫—Ä–∞–Ω–æ–≤ */
        .view { display: none; padding: 16px; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .active { display: block; }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∏ —ç–ª–µ–º–µ–Ω—Ç—ã */
        .card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .section-title { font-size: 13px; color: #818c99; text-transform: uppercase; margin: 0 0 8px 4px; letter-spacing: 0.3px; }
        
        /* –ò–Ω–ø—É—Ç—ã –∏ –°–≤–∏—Ç—á–∏ */
        label { display: block; font-size: 14px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        input[type="text"], input[type="number"] { 
            width: 100%; box-sizing: border-box; padding: 12px; border: 1px solid #dce1e6; 
            border-radius: 8px; background: #f5f5f5; font-size: 16px; margin-top: 4px;
        }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ced4da; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--vk-blue); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn { background: var(--vk-blue); color: white; border: none; padding: 14px; border-radius: 10px; width: 100%; font-size: 16px; font-weight: 600; cursor: pointer; margin-top: 10px; }
        .btn:disabled { opacity: 0.6; }
        .btn-pay { background: #4bb34b; }
        
        .loader { text-align: center; margin-top: 40vh; }
        .status-tag { display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 12px; font-weight: bold; }
        .status-ok { background: #e7f8ed; color: #1c7332; }
    </style>
</head>
<body>

    <!-- –≠–ö–†–ê–ù 1: –ó–ê–ì–†–£–ó–ö–ê -->
    <div id="view-loading" class="view active">
        <div class="loader">
            <div style="font-size: 24px; margin-bottom: 10px;">‚åõ</div>
            <div id="loading-text">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –±–∞–∑–æ–π...</div>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 2: –ü–ï–ô–í–û–õ–õ (–ù–æ–≤—ã–π —é–∑–µ—Ä) -->
    <div id="view-paywall" class="view">
        <div class="card" style="text-align: center;">
            <div style="font-size: 48px; margin-bottom: 16px;">üíé</div>
            <h2>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
            <p style="color: #626d7a;">–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ—Ä–≥–æ–≤–æ–≥–æ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –≤ Tribute.</p>
            <button class="btn btn-pay" onclick="openTribute()">–û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Tribute</button>
        </div>
    </div>

    <!-- –≠–ö–†–ê–ù 3: –ì–õ–ê–í–ù–ê–Ø (–ù–∞—Å—Ç—Ä–æ–π–∫–∏) -->
    <div id="view-main" class="view">
        <div class="section-title">–°—Ç–∞—Ç—É—Å –∞–∫–∫–∞—É–Ω—Ç–∞</div>
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <div style="font-weight: 600;" id="user-level">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div style="font-size: 12px; color: #818c99;">ID: <span id="display-id"></span></div>
                </div>
                <div class="status-tag status-ok">–ê–ö–¢–ò–í–ù–û</div>
            </div>
        </div>

        <div class="section-title">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞</div>
        <div class="card">
            <label>–ê–∫—Ü–∏–∏ <input type="text" id="in_tickers_stocks" placeholder="SBER, GAZP"></label>
            <label>–û–±–ª–∏–≥–∞—Ü–∏–∏ <input type="text" id="in_tickers_bonds" placeholder="SU26238"></label>
            <label>–§—å—é—á–µ—Ä—Å—ã <input type="text" id="in_tickers_fut" placeholder="RIZ3"></label>
        </div>

        <div class="section-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–æ–±–æ—Ç–∞</div>
        <div class="card">
            <label>–ë–æ—Ç –í–ö –≤–∫–ª—é—á–µ–Ω 
                <div class="switch"><input type="checkbox" id="sw_vk_on"><span class="slider"></span></div>
            </label>
            <label>–ë–æ—Ç –¢–ì –≤–∫–ª—é—á–µ–Ω 
                <div class="switch"><input type="checkbox" id="sw_tg_on"><span class="slider"></span></div>
            </label>
            <hr style="border: 0; border-top: 1px solid #f0f2f5; margin: 12px 0;">
            <label>–ü–µ—Ä–∏–æ–¥ ADR (–¥–Ω–∏) <input type="number" id="in_adr_days" style="width: 80px;"></label>
            <label>–ü–æ—Ä–æ–≥ RSI <input type="number" id="in_rsi_period" style="width: 80px;"></label>
        </div>

        <button class="btn" id="save-btn" onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
    </div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbx1RtFb9o-XMooNAFgD-tnnDeprncLYvSzfxveWmsFa9H2-ZXUo4Gp6G10i9BvpHd6cgA/exec"; 
    let currentVkId = "";

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById(viewId).classList.add('active');
    }

    async function init() {
        try {
            await vkBridge.send("VKWebAppInit");
            const urlParams = new URLSearchParams(window.location.search);
            currentVkId = urlParams.get('vk_user_id');

            if (!currentVkId) {
                document.getElementById('loading-text').innerText = "–û—à–∏–±–∫–∞: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∏–∑ –í–ö";
                return;
            }

            document.getElementById('display-id').innerText = currentVkId;

            // –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö. tribute_status="none" –¥–ª—è —Ç–µ—Å—Ç–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
            const response = await fetch(`${GAS_URL}?action=check_or_register&vk_id=${currentVkId}&tribute_status=none`);
            const res = await response.json();

            if (res.status === "guest") {
                showView('view-paywall');
            } else {
                fillForm(res.data);
                showView('view-main');
            }
        } catch (e) {
            document.getElementById('loading-text').innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º";
        }
    }

    function fillForm(data) {
        document.getElementById('user-level').innerText = data.level + " –¥–æ—Å—Ç—É–ø";
        document.getElementById('in_tickers_stocks').value = data.tickers_stocks || "";
        document.getElementById('in_adr_days').value = data.adr || "20";
        document.getElementById('sw_vk_on').checked = (data.vk_on === "–í–∫–ª");
        // –û—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
    }

    async function saveData() {
        const btn = document.getElementById('save-btn');
        btn.disabled = true;
        btn.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";

        const payload = {
            vk_id: currentVkId,
            tickers: document.getElementById('in_tickers_stocks').value,
            adr: document.getElementById('in_adr_days').value,
            vk_on: document.getElementById('sw_vk_on').checked ? "–í–∫–ª" : "–í—ã–∫–ª"
        };

        try {
            const url = `${GAS_URL}?action=update_settings&` + new URLSearchParams(payload);
            await fetch(url);
            btn.innerText = "‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ";
            setTimeout(() => { btn.disabled = false; btn.innerText = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"; }, 2000);
        } catch (e) {
            alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏");
            btn.disabled = false;
        }
    }

    function openTribute() {
        vkBridge.send("VKWebAppOpenURL", {"url": "https://wiki.tribute.tg/ru"});
    }

    init();
</script>
</body>
</html>





